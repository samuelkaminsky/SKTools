name: 'ðŸ”§ Gemini Fix Failure'

on:
  workflow_run:
    workflows:
      - 'check-standard.yaml'
      - 'lint-project.yaml'
      - 'test-coverage.yaml'
      - 'pkgdown.yaml'
    types:
      - completed

jobs:
  invoke-gemini-fix:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    uses: ./.github/workflows/gemini-invoke.yml
    permissions:
      contents: read
      id-token: write
      issues: write
      pull-requests: write
    with:
      issue_number: ${{ github.event.workflow_run.pull_requests[0].number }}
      prompt: '/gemini-fix'
      additional_context: "The workflow '${{ github.event.workflow_run.name }}' (Run ID: ${{ github.event.workflow_run.id }}) failed. Please analyze the logs, reproduce the failure locally, and implement a fix."
    secrets: inherit
